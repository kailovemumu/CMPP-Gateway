package dorox.app;

import dorox.app.mq.event.RouteRequestEvent;
import dorox.app.util.MqUtil;
import org.apache.avro.util.Utf8;
import org.apache.commons.lang3.StringUtils;
import org.springframework.amqp.rabbit.core.RabbitTemplate;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.CommandLineRunner;
import org.springframework.core.annotation.Order;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.stereotype.Component;

import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;
import java.util.Map;

@Component
@Order(value=1)
public class ToolMain implements CommandLineRunner{
//	private static final Logger logger = LoggerFactory.getLogger(ToolMain.class);

    static SimpleDateFormat sdf = new SimpleDateFormat("yyyy");
    static String table_prefix = "detail_report_";

    @Autowired
    private JdbcTemplate jdbcTemplate;
    @Autowired
    private RabbitTemplate rabbitTemplate;


    String messageIds = "";
            //"S104225G18NPHNHH,S104225G18NPHNHK,S104225G71Y8FA80,S104225GHSWDZ2FW,S104225GKGH7TK68,S104225GKGH7TK69,S104225H4932FDGC,S104225HAANPP1KP,S104225M0XAMDF3C,S104225MDK1BS3C0,S104225MDK1G5MA8,S104225MDK1G5MA9,S104225MDR4CKRKP,S104225MXP356SA8,S104225N4YXH958H,S104225N52XN80ZC,S104225N5NC026NC,S104225NK1T2A5AW,S104225NZBAFDXWH,S104225P085H14M8,S104225P8BH90CPH,S104225P98CTF2RP,S104225PCZSWBANC,S104225PFK801N0H,S104225PZR7A7354,S104225R23B1MHSW,S104225R4RT3HFNC,S104225R674K9F3C,S104225RBP7GSG54,S104225RBP7N623C,S104225RDS2B1CSW,S104225RFT0A0SW0,S104225RFZ52KY5P,S104225RG7CZF6NC,S104225RGW101XGC,S104225RR4SCW0M8,S104225RWW71BF80,S104225RXX355W6W,S104225S71K77ZMW,S104225SBKNG76RP,S104225SG92GCS5P,S104225SH5X6RC4H,S104225SRAM9RKP0,S104225SX22NF1D4,S104225T66BFW6FW,S104225TF9WD73F8,S104225TNT4X74SW,S104225TNT57DRKP,S104225TNZ97KN9P,S104225TPBSWBANC,S104225TPW3YY98H,S104225WMBKDNDKP,S104225WMBKDNDKR,S104225WMBKTY2CH,S104225WN45PKG2W,S104225YKF3RXM14,S104225YMZC4YT0H,S104225YNBT9DTHH,S104225YPCSM01YW,S104225YWWZ0C280,S104225Z36SH5N9P,S104225Z36SH5N9R,S104225Z5K0T7ANC,S104225ZM06T69YW,S104225ZPSTWHD1P,S104225ZTRKMGNF8,S10422604RRWP84H,S10422605MMM1028,S10422605MN07HX4,S1042260RD40PX40,S1042260RK6CFWM8,S1042260SM4M98H0,S10422611WRCD494,S10422611WRCD495,S10422619BNNT6RR,S10422619W2KG5D4,S1042261FHCH0ACH,S1042261FPHYAWZC,S1042261SNX0R3MW,S1042261TCGHF8ZC,S1042261Z3X75028,S104226248KR3FY8,S104226255F7K4ZC,S10422625RZ01CDP,S10422628CCFXRKP,S1042262DD0G270H,S1042262FM1173F8,S1042262M1854ZC0,S1042262M9HC7WPH,S1042262NSZFASA8,S1042262NSZFASA9,S1042262R87XBZ9P,S1042262RWSYNANC,S1042262S12PHTF8,S10422631W409WX4,S104226324ASFAY8,S1042263641NH6W0,S10422636HBFHB2W,S1042263DMZ6D3MW,S1042263G48TKM14,S1042263H9AGXTXP,S1042263NH9N3540,S1042263TW95FG54,S1042263X9KNZ72W,S1042263XKXA0DP0,S1042263ZNSKF23C,S104226419A1ZF80,S10422641KH077R4,S10422642MKKHKYW,S10422643GB9K0BC,S1042264CTYAFP28,S1042264GF99PTF8,S1042264GF99PTF9,S1042264GF9D4ACH,S1042264H70B44H0,S1042264H70B44H1,S1042264MXFRX680,S1042264MXG0P84H,S1042264N5P3391P,S1042264N5P6FW00,S1042264WFN1CCBC,S1042264WFN4TZ9P,S1042264WFNBN168,S1042264WFNG2H4H,S1042264Z945KDD4,S10422650A3F3NTC,S10422650A3F3NTD,S10422650A3KG6RP,S10422650A3WA8M8,S10422650MWS8NHK,S10422650YM8H18H,S104226512S1WX40,S10422651TD6NR40,S10422651TDDFT0H,S1042265CKDBPCBC,S1042265DYBP10PH,S1042265FAX8SP28,S1042265RXT5Y5P0,S1042265ZZGWPARP,S104226607M4M428,S10422660BT4298H,S10422660BT7DW6W,S10422660GYG4H94,S1042266325F6S14,S1042266368X911P,S10422665HG4APBC,S10422666KDDHN7C,S10422666XP7R58H,S1042266BM2NWF14,S1042266BYCBXSK4,S1042266CG14YN2W,S1042266CG1BRPZC,S1042266FX43WZ2W,S1042266GKS2HDP0,S1042266K34N17HH,S1042266K7A7G3F8,S1042266KZYWNRS8,S1042266NXPZY51P,S1042266RZNZ56K4,S1042266SH7W9AFW,S1042266W5P0NB9P,S10422670RZXK5KP,S10422675SMA09S8,S10422675YMCZ5D4,S104226773NNK7HH,S104226780K8SP28,S104226784P9MA80,S1042267CX18T7R4,S1042267D14HDZTC,S1042267DKPDM3R4,S1042267FA92SS14,S1042267FA92SS15,S1042267SS2G3M5P,S1042267TFSN6RP0,S1042267WGPM63R4,S1042267WTZGS4PH,S1042267ZSNB4W4H,S10422680B74XD41,S10422680B7BPG0H,S10422680G9YY1D4,S10422680THR2GF8,S10422683YC6AGTC,S10422687M031CSW,S10422687M09WFNC,S10422688Z2S56Y8,S10422689BFY0G0H,S1042268A029FG54,S1042268A02CY23C,S1042268A88WTZ9P,S1042268D712D7HH,S1042268D712D7HK,S1042268FWKR2140,S1042268FWKR2141,S1042268G0PBN2FW,S1042268G0PBN2FX,S1042268G0PBN2FY,S1042268KFY81DS8,S1042268M3FS78BC,S1042268NX35H8SW,S1042268NX3CBANC,S1042268RAF0W4H0,S1042268S32FK7XP,S1042268S32M0SW0,S1042268S78TH9D4,S1042268X64YANR4,S1042268XF6ABPDP,S1042268XMGPN3F8,S1042268XMGZF5AW,S1042268XMHNZB0H,S1042268ZWAC1SY8,S10422690XB22XKP,S104226919S6KY5P,S104226922HYB7C0,S1042269406GAXYW,S10422694X38NKWH,S104226959DW4ZR4,S104226966APX6K4,S10422696SX1NC94,S10422697ZTW2TMW,S1042269DR8WTS3C,S1042269DRAD5P94,S1042269DXBMWACH,S1042269FS57D5YW,S1042269FYAK4000,S1042269P75X3354,S1042269R83PMY80,S1042269WZFW80M8,S1042269WZFW80M9,S1042269ZDX3DKP0,S104226A397PZX1P,S104226A397WBC00,S104226A3XR5XA5P,S104226A4MGMTKGC,S104226A63TCT3TC,S104226A6WFR1FRP,S104226A6WFR1FRR,S104226A6WFWD1P0,S104226AAW4GBH6W,S104226ABX3DN5S8,S104226ACKZ197HH,S104226ACRZWR8X4,S104226AF3667354,S104226AHD9XMHSW,S104226AHXSRZ2FW,S104226AHXSRZ2FX,S104226AHXSXAKD4,S104226AK1ZWSSNC,S104226ANH3Y05WH,S104226ANWB5STMW,S104226AP4PXW46W,S104226AP4R17N54,S104226AP8TYNSCH,S104226AS2KD9680,S104226AS2KD9681,S104226AS6N16D68,S104226ASATRTHH0,S104226AST4APBC0,S104226AYFG0NA14,S104226AZZX3F04H,S104226B03ZXFHDP,S104226B0400Y3C0,S104226B25ZW1XGC,S104226B2A1S5R8H,S104226B2M9N21S8,S104226B2SAR94ZC,S104226B47NRC0M8,S104226B7MW683XP,S104226B7MW9NMW0,S104226B83838A3C,S104226B98B53C94,S104226BC78F1400,S104226BCGA4X6K4,S104226BCTHZ1PM8,S104226BDH8W9S80,S104226BF0KYWPX4,S104226BPAG6BT2W,S104226BRGHYP0ZC,S104226BRGHYP0ZD,S104226BRNPD5SY8,S104226BX4ATRD40,S104226BX7CWH3XP,S104226BXNCYKK1P,S104226BY44B4XD4,S104226C2P46XDS8,S104226C34K6KFCH,S104226C34KTN540,S104226C34KZ2P28,S104226C3R53RMA8,S104226C8RK6R1P0,S104226CCK6CF3R4,S104226CF6R4FA80,S104226DBS4ACARP,S104226DBS4DTXP0,S104226DD39DSTMW,S104226DN0THSX8H,S104226DN927GWBC,S104226DN92AZB9P,S104226DNXGZ8BC0,S104226DPA37TGXP,S104226DPA3M24PH,S104226DPF7FSGF8,S104226DPF7M62CH,S104226DR6TRPHZC,S104226DTXB0AB7D,S104226DTXB75D40,S104226DW1F8139P,S104226DW5K21NMW,S104226DX2AG706W,S104226F38BK08SW,S104226F3PS4DMNC,S104226F4RPPFNC0,S104226F52009968,S104226F7WGD9F3C,S104226FCR2WX028,S104226FCX6X0XS8,S104226FFAMH5F3C,S104226FG7DF95YW,S104226FGBHRZY14,S104226FNNH8B828,S104226FNNHG69YW,S104226FNNHMKWX4,S104226FNTNY8HZC,S104226FPC5WW5WH,S104226FR4T6F1S8,S104226FR4THPMK4,S104226FR8Z36CH0,S104226FSM7M3TR4,S104226G1WZ39C4H,S104226G254GZ1WH,S104226G2982CTTC,S104226G2985WARP,S104226G298H2ZHH,S104226G4B6CM6ND,S104226G4GANK680,S104226G5HHYHW4H,S104226G5HK8TCZC,S104226G75W9X2A8,S104226G75WD8K8H,S104226G7A5D9BF8,S104226G7A5TH094,S104226G7A5TH095,S104226G9H0FYNR4,S104226GA4GH632W,S104226GA4GNKM14,S104226GA8MDM6A8,S104226GD34ZA3R4,S104226GD7805RYW,S104226GHSKN9494,S104226GK2XYC1KP,S104226GKB68YDWH,S104226GKG8PPDAW,S104226GNXS1N354,S104226GXASN90BC,S104226HC8F6K028,S104226HFSRCF7MW,S104226HFSRCF7MX,S104226HGNH76CH0,S104226HR4H0ZK68,S104226HRCTSCARP,S104226HS9N666A8,S104226HY56TKA5P,S104226K1HACHPX4,S104226K28YY9W6W,S104226K31SZM1S8,S104226K3F2W1N0H,S104226K3F2W1N0K,S104226K979547TC,S104226KB5447BMW,S104226KB5447BMX,S104226KBRKZBDKP,S104226KRAFA3X1P,S104226KS7AAZB9P,S104226KSBFKYAY8,S104226KZ3S0RA5P,S104226M7P0A82K4,S104226M7P0DNKGC,S104226M8HT1HPH0,S104226M8HT507F8,S104226MAMY1CB2W,S104226MAMYRXHPH,S104226MASYB68M8,S104226MASYB68M9,S104226MASYM1AFW,S104226MAZ3ZP4H0,S104226MAZ433NF8,S104226MB373Z9P0,S104226MB377AWM8,S104226MB78D1FRP,S104226MBNWKDBTC,S104226MD541698H,S104226MDD9W2GTC,S104226MDY3F1D40,S104226MDY3F1D41,S104226MF27F5AW0,S104226MF27KHXS8,S104226MF62DTT2W,S104226MFA951DD4,S104226MFA9MNK68,S104226MHHACMZHH,S104226MHHANF1D4,S104226MK0NXCG0H,S104226MMM5B9C4H,S104226MMYGDK9GC,S104226MNZFS3GXP,S104226MNZFS3GXR,S104226MP3GPZ44H,S104226MPW560G0H,S104226MR49N9X68,S104226MT29X4ZC0,S104226MT2AWD6Y8,S104226MTMTP91AW,S104226MTSYAY2RP,S104226MW38HKG2W,S104226MX00DCXD4,S104226MX00HWCBC,S104226MX8745WH0,S104226MXC994S5P,S104226MXC9Y6CX4,S104226MXWWAWWSW,S104226MY9B95CDP,S104226N0ZCGCWSW,S104226N35G80S5P,S104226N3Y6CTM5P,S104226NGR09C0M8,S104226NGX55CMY8,S104226NHRY1H8SW,S104226NMNPRWARP,S104226NMTW4YKS8,S104226NX5R27354,S104226NZ7M9PNHH,S104226P1Y4DMNC0,S104226P2Z0AKZF8,S104226P3BD03B9P,S104226P7703WBC0,S104226P98T2FW00,S104226PADY7RD40,S104226PBMYRY9KP,S104226PCNY97KWH,S104226PKPN98ZR4,S104226PKWSHZNTC,S104226PMRS85680,S104226PN646HXD4,S104226PN64P7168,S104226PPTHWK214,S104226PPTK00HZC,S104226PRH6HDFRP,S104226PRPA6ATMW,S104226PRPAD5XGC,S104226PTM742FFW,S104226PW6KSFP28,S104226PWN8FHSW0,S104226PWT5NMW00,S104226PWT5YDXWH,S104226PXP044C28,S104226PY07XK5KP,S104226PY4CRKTXP,S104226PYCPRXN9P,S104226PYCPX9680,S104226R0YTHZR40,S104226R1GBAPA3C,S104226R1ZYCCCPH,S104226R283FTDKP,S104226R2C7X604H,S104226R6H34MAK4,S104226R6H381XGC,S104226R6P68XGR4,S104226R6P6C92NC,S104226R6P6GPKKP,S104226R89SDW5GC,S104226R89SPN7C0,S104226R8M3DC8DP,S104226R8M3DC8DR,S104226R8M3DC8DS,S104226R92A3PH94,S104226R92AAGM5P,S104226R96FKFKS8,S104226R9FSWKG2W,S104226R9Z7KFDWH,S104226RBHNMCZR4,S104226RBHNRWFNC,S104226RBHNX81KP,S104226RBPR6A6NC,S104226RBPR6A6ND,S104226RCKKKC9S8,S104226RCKKPTWPH,S104226RCXXR3P4H,S104226RD1Z5KC4H,S104226RFB7K38BC,S104226RFNGZKPM8,S104226RFNHHNB9P,S104226RG8405BF8,S104226RGC597HH0,S104226RGWRTY2CH,S104226RMN0XFCH0,S104226RP07DT8PH,S104226RP07K6TMW,S104226RRY1K1P00,S104226RRY1K1P01,S104226RTGK8A614,S104226RW886A04H,S104226RWCC32AY8,S104226RWHFFWACH,S104226RWPHNT828,S104226RXXPAP0ZC,S104226RXXPF3GXP,S104226RXXPF3GXR,S104226RY1TMAR1P,S104226RYF4AN2W0,S104226RZ6ZCN0X4,S104226RZG6TX5KP,S104226S07T9M8ZC,S104226S07T9M8ZD,S104226S2M3S3K68,S104226S3FWFTP4H,S104226S47FHYRP0,S104226S4GPXD400,S104226S4NZ9TPDP,S104226S6S0KXXWH,S104226S724AS2CH,S104226S769DKSK4,S104226S769K19GC,S104226S7AP8THX4,S104226S9HCSSNC0,S104226S9HD1KR8H,S104226S9PGTM9KP,S104226S9WKX5P94,S104226SA90Y95YW,S104226SBSD6GCZC,S104226SBSD6GCZD,S104226SBYDYGZ9P,S104226SCN6H96K4,S104226SDWAAKFCH,S104226SPF9Y29YW,S104226SRB3RF79P,S104226SSH5DSD68,S104226SY7NG8A3C,S104226T6G55NRD4,S104226TCCKA3828,S104226TDDGSPRWH,S104226TDDH1GTR4,S104226TDXZ62W94,S104226TK11FCR68,S104226TKKK1A894,S104226TKKKMBZ0H,S104226TKRN9PPX4,S104226TKXZW3B9P,S104226TPWG1TT2W,S104226TRD0RHA3C,S104226TRD13SYY8,S104226TRK9X0N7C,S104226TRKAW8YRP,S104226TS5SW80M8,S104226TS5T6FKD4,S104226TS5TTH84H,S104226TS5TYZT2W,S104226TTN4A1028,S104226TTN4A1029,S104226TWGWPFF5P,S104226TX4BFYTMW,S104226TX4C40FA8,S104226TZ65WGKGC,S104226TZ65ZZ4DP,S104226W036869KP,S104226W0BBZN168,S104226W0BCD94ZC,S104226W0GKCRA5P,S104226W0GKNHC28,S104226W0NKN3PSW,S104226W0TRY2PBC,S104226W0ZX5RCDP,S104226W1C7WM98H,S104226W1HDHGP4H,S104226W1PKYY6NC,S104226W1PM94TF8,S104226W250B01KP,S104226W5435CRGC,S104226W5C0371GC,S104226W64RTP37C,S104226W6D22T0H0,S104226W79T2A5AW,S104226W79TY6XYW,S104226W8N18CCPH,S104226W8T36H8DP,S104226W8Z67BYNC,S104226W97PZA3R4,S104226W97RT6W94,S104226WAX16G2FW,S104226WB17C2K40,S104226WBDH0ZC00,S104226WC6A07GHH,S104226WCACXNMW0,S104226WDGCGZSRP,S104226WDNG6HW4H,S104226WDNGHTCZC,S104226WDTS4KHBC,S104226WDZTZ9X68,S104226WFPH3D0PK,S104226WFPHA82K4,S104226WFWHYX214,S104226WFWHYX215,S104226WFWK93MW0,S104226WGD1SPWDP,S104226WGRGXKAW0,S104226WGXF5B6CH,S104226WH1PWHWSW,S104226WH5XZCHZC,S104226WHSB5G06W,S104226WHSB8YG54,S104226WKT6P7NF8,S104226WKT6TN6CH,S104226WS32NPH94,S104226WS778Y4PH,S104226WSZXWNA14,S104226WSZY02WZC,S104226WT85FPHM8,S104226WYB1PDSK4,S104226WYB1Z8WDP,S104226WYG5DSMCH,S104226WYG5W177C,S104226WYG5W177D,S104226X08PGHSFW,S104226X0R5526A8,S104226X1DXCHWSW,S104226X1YCZZ354,S104226X26MH07TC,S104226X6A8YZ8PH,S104226X6MNBDSY8,S104226X6SPPH000,S104226X6SPTZFY8,S104226X8C3MSNC0,S104226XBZCKCW4K,S104226XCBTXBBMW,S104226XD4KWNG7C,S104226XDK279X68,S104226XDK2ARC4H,S104226XF1C2A1D4,S104226XF5FZS4PH,S104226XFM125ZTC,S104226XH38W5F3C,S104226XHTWKDBTC,S104226XK04147TC,S104226XK4ATRD40,S104226XKWZCY3C0,S104226XM9AW85WH,S104226XMKKMCNXP,S104226XMKKRW6W0,S104226XMXXS4280,S104226XN26MR9GC,S104226XNYXH8CBC,S104226XNYXH8CBD,S104226XP331ARAW,S104226XP774Y614,S104226XPB8AHW4H,S104226XSXHGSB7C,S104226XT9YKKKAW,S104226XT9YWCN7C,S104226XTM8D2CX4,S104226XTYG0BX1P,S104226XWZD2SS14,S104226XWZD9KTXP,S104226XWZDD1AW0,S104226XWZDHCXS8,S104226XX7NWZ828,S104226XZS3TYA80,S104226XZS464Z2W,S104226XZY3TDN0H,S104226XZY45P7TC,S104226Y0MZWRWH0,S104226Y2CC42R1P,S104226Y2HKPHHZC,S104226Y2HKPHHZD,S104226Y2WYP4NXP,S104226Y2WYTH6W0,S104226Y52WH77R4,S104226Y52WT29KP,S104226Y5B5GTANC,S104226Y5TMXS04H,S104226Y680KAKD4,S104226Y680PS4BC,S104226Y6819TT2W,S104226Y6C56H5WH,S104226Y74TXPY3C,S104226Y78SXZZ9P,S104226Y7D1DS2RP,S104226Y7D1ZC6FW,S104226Y7R9ZP1YW,S104226Y9ZARNC94,S104226YABW71HPH,S104226YABWDWMK4,S104226YABWZFSA8,S104226YABX9RB54,S104226YAP2MZDYW,S104226YAP2XSGTC,S104226YAP3814M8,S104226YAW2RY9KP,S104226YAW2X9WH0,S104226YBR0FG91P,S104226YBR0FG91R,S104226YBX3GAZ7C,S104226YC5AT5K1P,S104226YCKTY94M8,S104226YF35S8PX4,S104226YF791ZCZC,S104226YFBDN51AW,S104226YFGKN8Z2W,S104226YFNHSZG7C,S104226YG4C83CM8,S104226YG4CBFZHH,S104226YG4CRRHBC,S104226YG8CWPC28,S104226YG8D6Z0X4,S104226YGCS04R68,S104226YGCS3H84H,S104226YGCS6ZT2W,S104226YGCYR6GTC,S104226YGCYWM2RP,S104226YHKY182Y8,S104226YHRS71WH0,S104226YK636586W,S104226YKMGA0H94,S104226YMN9G6B7C,S104226YPXCRCCBC,S104226YR9RK4940,S104226YR9RTZB0H,S104226YRDYHHFA8,S104226YRM4S40ZC,S104226YSFX81215,S104226YSFXM7MW0,S104226YSFXRN5S8,S104226YSZ9S2YY8,S104226YT3CCP094,S104226YW8MGTC00,S104226YW8MN6YY8,S104226YWHPTR58H,S104226YX9GC2ZHH,S104226YX9GGFFFW,S104226YX9GS9HBC,S104226YXY2DAAY8,S104226YXY2DAAY9,S104226YXY2HRXWH,S104226YXY2THZR4,S104226YY6CC6RAW,S104226YZTSWT91P,S104226Z0HF8D6Y8,S104226Z1XP7PCBC,S104226Z2A44PMK4,S104226Z32R43XP0,S104226Z32R7GCM8,S104226Z76GSFKD4,S104226Z76H84R68,S104226Z7ANN706W,S104226Z7FT2977C,S104226Z8BFTR2NC,S104226ZAKPF5SK4,S104226ZARSSH754,S104226ZBSRPTWPH,S104226ZBSRW7BMW,S104226ZF4Z0K8H1,S104226ZF4Z40TF8,S104226ZFKK065P0,S104226ZGSGN623C,S104226ZHAYT8BC0,S104226ZM4FZS9YW,S104226ZMHZZFAK4,S104226ZN9N0XNMW,S104226ZNY3R9Z54,S104226ZPAHATB0H,S104226ZRNW57HH0,S104226ZRNW57HH1,S104226ZRW0XWNXP,S104226ZRW0XWNXR,S104226ZSWYB5Y5P,S104226ZXGCG3Y14,S104226ZXGCMGCZC,S104226ZYWHCB1GC,S104227005W3BP4H,S104227027S3AF5P,S10422702BX0SKD4,S104227030CXYRAW,S10422703R4NT828,S10422703R521WX4,S10422706BDK19GC,S10422706GMHDFRP,S10422707CCXGGXP,S10422707CD0Z2W0,S10422707PR16Y80,S1042270BWFZ4CBC,S1042270CR9G1GC0,S1042270D1K8F8ZC,S1042270D5T3T6RP,S1042270D5T76RP0,S1042270D60ZHTTC,S1042270DDZDR214,S1042270F2DXYSNC,S1042270F6P02SA8,S1042270GGWKT3F9,S1042270GP2NZ354,S1042270GP2YS51P,S1042270H07SA428,S1042270HHWBZDKP,S1042270KRX1GX1P,S1042270NGFXT8PH,S1042270NGFXT8PK,S1042270NZYY71WH,S1042270PPRB5968";


    @Override
    public void run(String... args) throws Exception {
        String[] messageIdArray = messageIds.split(",");
        for (String messageId: messageIdArray){

            String table = getTableFromMessageId(messageId);
            Map<String, Object> map = jdbcTemplate.queryForMap(
                    "select DOWN_PORT_CODE, UP_PORT_CODE, DOWN_REGION_CODE, UP_REGION_CODE, MSG_ID, PHONE, CONTENT, SRC_ID from " +
                            table + " where message_Id='" + messageId + "'");

            String downName = (String)map.get("DOWN_PORT_CODE");
            String upName = (String)map.get("UP_PORT_CODE");
            String downRegionCode = (String)map.get("DOWN_REGION_CODE");
            String upRegionCode = (String)map.get("UP_REGION_CODE");
            String msgId = StringUtils.strip((String)map.get("MSG_ID"),"[]");

            List<Utf8> msgIds = new ArrayList<>();
            for(String mId : msgId.split(",")){
                msgIds.add(new Utf8(mId));
            }

            String phone = (String)map.get("PHONE");
            String content = (String)map.get("CONTENT");
            if("799899".equals(downName)){
                content = "【湖北电力】" + content;
            }
            String srcIds = (String)map.get("SRC_ID");
            String[] srcIdArray = srcIds.split("/");
            String srcId = srcIdArray[0], upSrcId=srcIdArray[1];

            RouteRequestEvent routeRequestEvent = new RouteRequestEvent(messageId, downName,
                    upName, phone, content, srcId, upSrcId, msgIds,
                    downRegionCode, upRegionCode);
            MqUtil.sendMsg(routeRequestEvent, rabbitTemplate, upRegionCode);
        }

    }

    private String getTableFromMessageId(String messageId) {
        String y = sdf.format(new Date());
        String md = messageId.substring(2,6);
        return table_prefix + y + md;
    }
}

